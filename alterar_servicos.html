<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alterar Serviços - Barbearia Pedro Rodrigues</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #222;
        color: #fff;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
      }
      .container {
        background: #333;
        padding: 40px 30px;
        border-radius: 10px;
        margin-top: 40px;
        text-align: center;
        width: 380px;
        box-shadow: 0 0 10px #111;
        max-width: 98vw;
      }
      h1 {
        color: #00c853;
        margin-bottom: 30px;
        font-size: 1.5em;
        letter-spacing: 1px;
      }
      .servicos-lista {
        margin-top: 20px;
        text-align: left;
      }
      .servico-item {
        background: #444;
        border-radius: 8px;
        margin-bottom: 15px;
        padding: 16px 12px;
        box-shadow: 0 2px 8px #1118;
        font-size: 1.1em;
        display: flex;
        flex-direction: column;
        gap: 3px;
        cursor: pointer;
        transition: background 0.2s;
      }
      .servico-item:hover {
        background: #555;
      }
      .servico-nome {
        color: #b2ff59;
        font-weight: bold;
        word-break: break-all;
      }
      .servico-preco {
        color: #fff;
        font-size: 1em;
      }
      .voltar-btn,
      .novo-btn {
        background: #007acc;
        color: #fff;
        border: none;
        border-radius: 5px;
        padding: 10px 22px;
        font-size: 1em;
        margin-bottom: 25px;
        cursor: pointer;
        transition: background 0.2s;
      }
      .novo-btn {
        margin-bottom: 0;
        margin-top: 20px;
        background: #00c853;
        color: #222;
        font-weight: bold;
      }
      .voltar-btn:hover {
        background: #005fa3;
      }
      .novo-btn:hover {
        background: #009e46;
        color: #fff;
      }
      /* Modal */
      .modal {
        display: none;
        position: fixed;
        z-index: 20;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.7);
        justify-content: center;
        align-items: center;
      }
      .modal-content {
        background: #333;
        padding: 30px 25px 20px 25px;
        border-radius: 10px;
        text-align: center;
        min-width: 300px;
        box-shadow: 0 0 15px #111;
        position: relative;
        width: 90vw;
        max-width: 340px;
      }
      .modal-content label {
        display: block;
        color: #b2ff59;
        text-align: left;
        margin-top: 12px;
        margin-bottom: 3px;
        font-size: 1em;
      }
      .modal-content input {
        width: 96%;
        padding: 8px;
        margin-bottom: 8px;
        border-radius: 6px;
        border: none;
        font-size: 1em;
        background: #222;
        color: #fff;
        outline: none;
      }
      .modal-content button {
        width: 100%;
        margin-top: 10px;
        padding: 10px 0;
        border-radius: 5px;
        font-size: 1em;
      }
      .btn-excluir {
        background: #ff5252;
        color: #fff;
        margin-top: 8px;
        margin-bottom: 0;
        font-weight: bold;
      }
      .btn-excluir:hover {
        background: #c62828;
      }
      .close-modal {
        position: absolute;
        right: 10px;
        top: 10px;
        color: #fff;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1.3em;
        padding: 0 8px;
        line-height: 1;
        border-radius: 50%;
        height: 32px;
        width: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: color 0.2s, background 0.2s;
      }
      .close-modal:hover {
        color: #00c853;
        background: rgba(0, 0, 0, 0.08);
      }
      .modal-title {
        color: #00c853;
        font-size: 1.2em;
        margin-bottom: 12px;
        margin-top: 0;
      }
      .modal-msg {
        margin-top: 8px;
        font-size: 1em;
        color: #b2ff59;
        min-height: 18px;
      }
      @media (max-width: 500px) {
        .container {
          padding: 18px 2vw;
          width: 99vw;
        }
        .servico-item {
          padding: 10px 7px;
          font-size: 1em;
        }
        .voltar-btn,
        .novo-btn {
          padding: 8px 10px;
          font-size: 0.97em;
        }
        .modal-content {
          padding: 16px 4vw 12px 4vw;
          min-width: unset;
          max-width: 99vw;
        }
        .close-modal {
          font-size: 1em;
          height: 28px;
          width: 28px;
          right: 6px;
          top: 6px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <button class="voltar-btn" onclick="voltar()">
        <i class="fa fa-arrow-left"></i> Voltar
      </button>
      <h1>Alterar Serviços</h1>
      <div class="servicos-lista" id="servicos-lista">
        <div style="color: #fff; text-align: center">Carregando...</div>
      </div>
      <button class="novo-btn" onclick="abrirNovoServico()">
        Novo Serviço
      </button>
    </div>

    <!-- Modal Editar/Criar Serviço -->
    <div class="modal" id="modalServico">
      <div class="modal-content">
        <button
          class="close-modal"
          onclick="fecharModalServico()"
          aria-label="Fechar"
        >
          &times;
        </button>
        <div class="modal-title" id="modalServicoTitulo">Editar Serviço</div>
        <label for="servicoNome">Nome</label>
        <input
          type="text"
          id="servicoNome"
          placeholder="Nome do serviço"
          autocomplete="off"
        />
        <label for="servicoPreco">Preço (R$)</label>
        <input
          type="number"
          id="servicoPreco"
          placeholder="Preço"
          min="0"
          step="1"
          autocomplete="off"
        />
        <button id="btnSalvarServico" onclick="salvarServico()">Salvar</button>
        <button id="btnExcluirServico" class="btn-excluir" style="display:none;" onclick="excluirServico()">Excluir</button>
        <div class="modal-msg" id="modalServicoMsg"></div>
      </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyAY-Win6vQEHP1XR_fG3NOg0PAkNPAcxSg",
        authDomain: "banco-de-dados-bd2a6.firebaseapp.com",
        projectId: "banco-de-dados-bd2a6",
        appId: "1:859895156791:web",
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      let servicos = [];
      let servicoEditIdx = null;

      function voltar() {
        window.history.back();
      }

      function carregarServicos() {
        const lista = document.getElementById("servicos-lista");
        lista.innerHTML =
          '<div style="color:#fff;text-align:center;">Carregando...</div>';

        db.collection("servicos")
          .doc("servicos")
          .get()
          .then((doc) => {
            if (doc.exists && Array.isArray(doc.data().lista)) {
              servicos = doc.data().lista;
              if (servicos.length === 0) {
                lista.innerHTML =
                  '<div style="color:#fff;text-align:center;">Nenhum serviço encontrado.</div>';
                return;
              }
              let html = "";
              servicos.forEach((s, idx) => {
                html += `
                <div class="servico-item" onclick="abrirEditarServico(${idx})">
                  <div class="servico-nome"><i class="fa fa-cut"></i> ${
                    s.nome || "(sem nome)"
                  }</div>
                  <div class="servico-preco">R$ ${
                    s.preco != null ? s.preco : "(sem preço)"
                  }</div>
                </div>
              `;
              });
              lista.innerHTML = html;
            } else {
              servicos = [];
              lista.innerHTML =
                '<div style="color:#fff;text-align:center;">Nenhum serviço encontrado.</div>';
            }
          })
          .catch((error) => {
            lista.innerHTML =
              '<div style="color:#ff5252;">Erro ao carregar serviços: ' +
              error.message +
              "</div>";
          });
      }

      function abrirEditarServico(idx) {
        servicoEditIdx = idx;
        const s = servicos[idx];
        document.getElementById("modalServicoTitulo").textContent =
          "Editar Serviço";
        document.getElementById("servicoNome").value = s.nome || "";
        document.getElementById("servicoPreco").value =
          s.preco != null ? s.preco : "";
        document.getElementById("modalServicoMsg").textContent = "";
        document.getElementById("modalServico").style.display = "flex";
        document.getElementById("btnSalvarServico").textContent = "Salvar";
        document.getElementById("btnExcluirServico").style.display = "block";
      }

      function abrirNovoServico() {
        servicoEditIdx = null;
        document.getElementById("modalServicoTitulo").textContent =
          "Novo Serviço";
        document.getElementById("servicoNome").value = "";
        document.getElementById("servicoPreco").value = "";
        document.getElementById("modalServicoMsg").textContent = "";
        document.getElementById("modalServico").style.display = "flex";
        document.getElementById("btnSalvarServico").textContent = "Adicionar";
        document.getElementById("btnExcluirServico").style.display = "none";
      }

      function fecharModalServico() {
        document.getElementById("modalServico").style.display = "none";
      }

      function salvarServico() {
        const nome = document.getElementById("servicoNome").value.trim();
        const precoStr = document.getElementById("servicoPreco").value.trim();
        const msg = document.getElementById("modalServicoMsg");

        if (!nome || precoStr === "") {
          msg.textContent = "Preencha todos os campos!";
          msg.style.color = "#ff5252";
          return;
        }

        const preco = Number(precoStr);
        if (isNaN(preco) || preco < 0) {
          msg.textContent = "Preço inválido!";
          msg.style.color = "#ff5252";
          return;
        }

        if (servicoEditIdx !== null) {
          servicos[servicoEditIdx] = { nome, preco };
        } else {
          servicos.push({ nome, preco });
        }

        db.collection("servicos")
          .doc("servicos")
          .set({ lista: servicos })
          .then(() => {
            msg.textContent = "Serviço salvo com sucesso!";
            msg.style.color = "#b2ff59";
            setTimeout(() => {
              fecharModalServico();
              carregarServicos();
            }, 800);
          })
          .catch((error) => {
            msg.textContent = "Erro ao salvar: " + error.message;
            msg.style.color = "#ff5252";
          });
      }

      function excluirServico() {
        if (servicoEditIdx === null) return;
        const msg = document.getElementById("modalServicoMsg");
        if (!confirm("Tem certeza que deseja excluir este serviço?")) return;

        servicos.splice(servicoEditIdx, 1);

        db.collection("servicos")
          .doc("servicos")
          .set({ lista: servicos })
          .then(() => {
            msg.textContent = "Serviço excluído com sucesso!";
            msg.style.color = "#b2ff59";
            setTimeout(() => {
              fecharModalServico();
              carregarServicos();
            }, 800);
          })
          .catch((error) => {
            msg.textContent = "Erro ao excluir: " + error.message;
            msg.style.color = "#ff5252";
          });
      }

      window.onload = carregarServicos;
      window.addEventListener("keydown", function (e) {
        if (e.key === "Escape") fecharModalServico();
      });
    </script>
  </body>
</html>
